<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.ut.scf.dao.project.IFactorContractInfoDao">
  <resultMap id="BaseResultMap" type="com.ut.scf.pojo.auto.FactorContractInfo">
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Tue May 23 13:36:14 CST 2017.
    -->
    <id column="contract_no" jdbcType="VARCHAR" property="contractNo" />
    <result column="sign_date" jdbcType="DATE" property="signDate" />
    <result column="contract_val_date" jdbcType="DATE" property="contractValDate" />
    <result column="contract_due_date" jdbcType="DATE" property="contractDueDate" />
    <result column="contract_type" jdbcType="VARCHAR" property="contractType" />
    <result column="order_batch_id" jdbcType="VARCHAR" property="orderBatchId" />
    <result column="product_type" jdbcType="VARCHAR" property="productType" />
    <result column="core_corp_id" jdbcType="VARCHAR" property="coreCorpId" />
    <result column="agency_corp_id" jdbcType="VARCHAR" property="agencyCorpId" />
  </resultMap>
  <select id="contractList" resultType="hashmap" parameterType="hashmap" >
  	select contract_no contractNo,sign_date signDate,contract_val_date contractValDate,
  	contract_due_date contractDueDate,contract_type contractType,order_batch_id orderBatchId,
  	product_type  productType,core_corp_id coreCorpId, agency_corp_id agencyCorpId
  	from factor_contract_info 
  	<where>
        1=1
        <if test="signDate != null and signDate !=''">
          and sign_date = #{signDate}
        </if>
    </where>
  </select>
  <select id="contractListInfo" resultType="hashmap" parameterType="hashmap" >
	select 
	fci.contract_no contractNo,
	fci.sign_date signDate,
	fci.contract_val_date contractValDate,
	fci.contract_due_date contractDueDate,
	fci.contract_type contractType,
	fci.order_batch_id orderBatchId,
	fci.product_type productType,
	fci.core_corp_id coreCorpId, 
	fci.agency_corp_id agencyCorpId,
	ci.corp_name agencyCorpName,
	po.corp_name coreCorpName,
	ci.orgn_num agencyOrgnNum,
    po.orgn_num coreOrgnNum
	from factor_contract_info  fci 
	join corp_info ci on fci.agency_corp_id=ci.corp_id
	join corp_info po on fci.core_corp_id=po.corp_id
	where  1=1
	<if test="contractNo != null and contractNo != ''">
		    and fci.contract_no LIKE CONCAT(CONCAT('%', #{contractNo}),'%')
		</if> 
	    <if test="contractType != null and contractType!='' ">  
	        and fci.contract_type LIKE CONCAT(CONCAT('%', #{contractType}),'%') 
	    </if>
	    <if test="productType != null and productType!='' ">  
	        and fci.product_type LIKE CONCAT(CONCAT('%', #{productType}),'%') 
	    </if>
	    <if test="agencyCorpName != null and agencyCorpName!='' ">  
	        and ci.corp_name LIKE CONCAT(CONCAT('%', #{agencyCorpName}),'%') 
	    </if>
	    <if test="coreCorpName != null and coreCorpName!='' ">  
	        and po.corp_name LIKE CONCAT(CONCAT('%', #{coreCorpName}),'%') 
	    </if>
</select>
  <select id="contractFileList" resultType="hashmap" parameterType="hashmap" >
  	select contract_no contractNo,file_name fileName,file_type fileType,
  	file_size fileSize,file_path filePath  
    from factor_contract_file_info 
  	<where>
        contract_no = #{contractNo}
    </where>
  </select>
  
  
   <select id="selectContractSequence" resultType="java.lang.String">
  	select right(MAX(contract_no),2) as sequence 
    from factor_contract_info 
    where sign_date = now()
  </select>
</mapper>